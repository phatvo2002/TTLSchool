@model TTLProject2.Models.HocSinhModel
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
	ViewData["Title"] = "Quản Lý Học Sinh";
}
<style>
	#hocsinhtable{

	}
</style>
<div class='contentpane'>
	 <div class='container-fluid mt-5'>
		<div id="dnn_ContentPane">
			<div class="DnnModule DnnModule-ThacsyOnline DnnModule-496">
				<div class="etep-3">
					<h2 class="text-center">
						<span id="dnn_ctr496_dnnTITLE_titleLabel" class="title ">QUẢN LÝ HỌC SINH </span>
					</h2>
					<div class='container-content' style="position:relative">
						<!--Thêm mới modal-->
						<button type="button" class="btn btn-success " data-bs-toggle="modal" data-bs-target="#exampleModal" style="position:absolute;left:74%;top:4%;z-index:100;border-radius:20px;">
							<i class="fa-solid fa-plus"></i>
							Thêm
						</button>
						<!-- Modal -->
						<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
							<div class="modal-dialog modal-xl">
								<div class="modal-content">
									<div class="modal-header" style="background-color: #3c8dbc; color:white;">
										<img src="~/asset/images/logo-school.png" style="width:80px;border-radius:50%"/> 
										<h5 class="modal-title p-2" id="exampleModalLabel">Thêm Mới Học Sinh</h5>
										<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
									</div>
									<form id="ThemMoiHocSinh" method="post">
									<div class="modal-body">
											<h4>1. Thông Tin Cá Nhân </h4>
										<div class="row mt-3">
												<div class="col-4">
													<label for="" class="form-label font-weight-bold">Mã Học Sinh <span class="text-danger">(*)</span></label>
													<input type="text" class="form-control" id="" autocomplete="MaHocSinh" aria-required="true" placeholder="Theo cú pháp : Kí tự đầu của họ tên - ngày sinh - năm " asp-for="MaHocSinh">
													<span asp-validation-for="MaHocSinh" class="text-danger"></span>
												</div>
												<div class="col-4">
													<label for="" class="form-label">Họ Tên <span class="text-danger">(*)</span></label>
													<input type="text" class="form-control" id=""  aria-required="true" placeholder="Vd . Võ Đăng Phát " asp-for="HoTen">
													<span asp-validation-for="HoTen" class="text-danger"></span>
												</div>
												<div class="col-4">
													<label for="" class="form-label">Giới Tính <span class="text-danger">(*)</span></label>
													<select class="form-select" aria-label="Default select example" asp-for="MaGioiTinh" asp-items="Model.DanhSachGioiTinh">
														<option selected>-- Chọn Giới Tính --</option>
														
													</select>
												</div>
										</div>
										<div class="row mt-3">
												<div class="col-6">
													<label for="" class="form-label">Ngày Sinh <span class="text-danger">(*)</span></label>
													<input type="date" class="form-control" autocomplete="NgaySinh" aria-required="true" id="" placeholder=" " asp-for="NgaySinh">
													<span asp-validation-for="NgaySinh" class="text-danger"></span>
												</div>
												<div class="col-6">
													<label for="" class="form-label">Số Điện Thoại <span class="text-danger">(*)</span></label>
													<input type="text" class="form-control" id="" autocomplete="SoDienThoai" aria-required="true" placeholder="Vd : 070..." asp-for="SoDienThoai">
													<span asp-validation-for="SoDienThoai" class="text-danger"></span>
												</div>
										</div>
										<div class="row mt-3">
												<div class="col-12 ">
													<label for="" class="form-label">Địa Chỉ Thường Trú  <span class="text-danger">(*)</span></label>
													<input type="Text" class="form-control" id="" autocomplete="DiaChiNha" aria-required="true" placeholder="Vd : Quận 12 , TPHCM" asp-for="DiaChiNha">
													<span asp-validation-for="DiaChiNha" class="text-danger"></span>
												</div>
										</div>
										<div class="row mt-3">
												<div class="col-6 ">
													<label for="" class="form-label">Dân Tộc <span class="text-danger">(*)</span></label>
													<select class="form-select " autocomplete="MaDanToc" aria-required="true" aria-label="Default select example" asp-for="MaDanToc" asp-items="Model.DanhSachDanToc">
														<option selected>-- Chọn Dân Tộc --</option>
										
														
													</select>
													<span asp-validation-for="MaDanToc" class="text-danger"></span>
												</div>
												<div class="col-6 ">
													<label for="" class="form-label">Quốc Tịch <span class="text-danger">(*)</span> </label>
													<select class="form-select " aria-label="Default select example" autocomplete="MaQuocTich" aria-required="true" asp-for="MaQuocTich" asp-items="Model.DanhSachQuocTich">
														<option selected>-- Chọn Quốc Tịch --</option>
										
													</select>
													<span asp-validation-for="MaQuocTich" class="text-danger"></span>
												</div>
										</div>
										<h4 class="mt-3">2. Thông Tin Phụ Huynh</h4>
										<div class="row mt-3">
												<div class="col-12 ">
													<label for="" class="form-label">Họ Tên Bố <span class="text-danger">(*)</span></label>
													<input type="Text" class="form-control" autocomplete="HoTenBo" aria-required="true" id="" placeholder="Vd: Nguyễn Văn A" asp-for="HoTenBo">
													<span asp-validation-for="HoTenBo" class="text-danger"></span>
												</div>
                                         </div>
										 <div class="row mt-3">
												<div class="col-6 ">
													<label for="" class="form-label">Nghề Nghiệp <span class="text-danger">(*)</span></label>
													<input type="Text" class="form-control" id="" autocomplete="NgheNghiep1" aria-required="true" placeholder="Vd: Xây Dựng" asp-for="NgheNghiep1">
													<span asp-validation-for="NgheNghiep1" class="text-danger"></span>
												</div>
												<div class="col-6 ">
													<label for="" class="form-label">Số Điện Thoại</label>
													<input type="Text" class="form-control" id="" autocomplete="SoDienThoaiBo" aria-required="true" placeholder="Vd: 090...." asp-for="SoDienThoaiBa">
													<span asp-validation-for="SoDienThoaiBa" class="text-danger"></span>
												</div>
										 </div>
											<div class="row mt-3">
												<div class="col-12 ">
													<label for="" class="form-label">Họ Tên Mẹ</label>
													<input type="Text" class="form-control" id="" placeholder="Vd: Nguyễn Thị B" asp-for="HoTenMe">
												</div>
											</div>
								         <div class="row mt-3">
												<div class="col-6 ">
													<label for="" class="form-label">Nghề Nghiệp</label>
													<input type="Text" class="form-control" id="" placeholder="Vd : Nội Trợ" asp-for="NgheNghiep2">
												</div>
												<div class="col-6 ">
													<label for="" class="form-label">Số Điện Thoại</label>
													<input type="Text" class="form-control" id="" autocomplete="SoDienThoaiMe" aria-required="true" placeholder="Vd : 090...." asp-for="SoDienThoaiMe">
													<span asp-validation-for="SoDienThoaiMe" class="text-danger"></span>
												</div>
										 </div>
											<h4 class="mt-3">3. Thông Tin Trường học </h4>
											<div class="row mt-3">
												<div class="col-12 ">
													<label for="" class="form-label">Tên Trường Tiểu Học</label>
													<input type="Text" class="form-control" id="" autocomplete="TruongHoc1" aria-required="true" placeholder="Vd : Trường tiểu học Chi Lăng" asp-for="TruongHoc1">
													<span asp-validation-for="TruongHoc1" class="text-danger"></span>
												</div>
												<div class="col-12 mt-3 ">
													<label for="" class="form-label">Tên Trường Trung Học Cơ Sở</label>
													<input type="Text" class="form-control" id="" autocomplete="TruongHoc2" aria-required="true" placeholder="Vd : Trường THCS Thông Tây Hội" asp-for="TruongHoc2">
													<span asp-validation-for="TruongHoc2" class="text-danger"></span>
												</div>
											</div>

											<h4 class="mt-3">4. Tình Trạng </h4>
											<div class="row mt-3">
											 <div class="col-6 ">
												<label for="" class="form-label">Lớp Học</label>
												<select class="form-select" aria-label="Default select example" asp-for="MaLop" asp-items="Model.DanhsachLopHoc">
													<option selected>-- Lớp Học --</option>
								
												</select>
											</div>
												<div class="col-6 ">
													<label for="" class="form-label">Trạng Thái</label>
													<select class="form-select" aria-label="Default select example" asp-for="MaTrangThai" asp-items="Model.DanhSachTrangThai">
														<option selected>-- Chọn trạng thái --</option>
														
													</select>
												</div>


											</div>
											<h4 class="mt-3">5. Thông tin tài khoản </h4>
											<p><i>Lưu ý : Email của học sinh phải bắt đầu bằng "Mã Học Sinh"  + Đuôi ".student.gmail.com"</i></p>
											<div class="row mt-3">
												<div class="col-12 ">
													<label for="" class="form-label">Email do nhà trường cấp </label>
													<input type="Text" class="form-control" id="" autocomplete="TruongHoc1" aria-required="true" placeholder='Vd : VDP.studentgmail.com' asp-for="Email">
													<span asp-validation-for="Email" class="text-danger"></span>
												</div>
												
											</div>

								   	</div>
										<div class="modal-footer" style="background-color: #3c8dbc">
										<button type="button" class="btn btn-danger" data-bs-dismiss="modal">Đóng</button>
										<button type="submit" class="btn btn-success">Thêm Mới</button>
									</div>
									</form>
								</div>
							</div>
						</div>
						<!--Thêm mới modal-->

						<!--Button Modal -->
						<button type="submit" class="btn btn-danger" id="delete-btn" style="position:absolute;left:80%;top:4%;border-radius:50px;z-index:1000;">
							<i class="fa-solid fa-trash"></i>
							Xóa
						</button>
						<button type="submit" class="btn text-white " style="position:absolute;left:85%;top:4%;border-radius:50px;z-index:1000;background-color:#3c8dbc;">
							<i class="fa-regular fa-envelope"></i>
							mail
						</button>
						<!--Button Modal-->
						
						<div id="dnn_ctr496_ContentPane">
							<!-- Start_Module_484 --><div id="dnn_ctr496_ModuleContent" class="DNNModuleContent ModThacsyOnlineC">
								<div id="dnn_ctr496_View_pnlContainer">
									<style>
										.DKForm {
											margin: 20px auto;
											padding: 10px 20px;
											border: 1px dashed #ddd;
										}
									</style>
									<body>
										<div id="">
											<div class="DKForm">
												<div class="row">
													<div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
														<table id="hocsinhtable" class="table table-striped " style="min-width: max-content;">
															<thead class="text-secondary-m2 bg-tbl-header ">
																<tr class="text-white">
																	<th class="border-0">Mã Học Sinh</th>
																	<th class="border-0">Tên Học Sinh </th>
																	<th class="border-0">Ngày Tháng Năm Sinh</th>
																	<th class="border-0">Email</th>
																	<th class="border-0">Số Điện Thoại </th>
																	<th class="border-0">Giới tính</th>
																	<th class="border-0">Lớp Học</th>
																	<th class="border-0">Địa chỉ nhà</th>
																
																	<th class="border-0">Trạng thái</th>
																
																	<th class="border-0 tbl-column-130"><i class="fa fa-cog"></i></th>
																</tr>
															</thead>
															<tbody></tbody>
														</table>
													</div>
												</div>
											</div>
										</div>
									</body>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div> 
</div>
<link rel="stylesheet" href="~/css/style.css" />
<link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
@section Scripts {
	<partial name="_ValidationScriptsPartial" />
	<script src="https://code.jquery.com/jquery-3.7.1.js"> </script>
	<script src="~/js/datatables.js"></script>
	<script src="~/lib/moment/moment.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
	<script>

		//Thêm Mới
		$(document).ready(function () {
			$("#ThemMoiHocSinh").submit(function (e) {
				e.preventDefault();
				var formData = new FormData($(this)[0]);
				console.log(formData);
				$.ajax({
					url: "SaveHocSinh/",
					type: "POST",
					data: formData,
					contentType: false,
					processData: false,
					success: function (response) {
						console.log(response)
						if (response.success) {
							Swal.fire({
								title: "Thành công !",
								text: response.success,
								icon: "success"
							});
							setTimeout(function () {
								window.location.reload();
							}, 1500);
							console.log(response.success);
						}
                        if (response.error == "Mã Học Sinh Đã Tồn Tại Trong Hệ Thống" || response.error == "Tên Học Sinh Đã Tồn Tại Trong hệ thống") {
							Swal.fire({
								title: "Lỗi  !",
								text: response.error,
								icon: "error"
							});
							console.log(response.error);
						}
						
					},
					error: function (xhr, status, error) {

						console.log(xhr.responseText);
					}
				})
			})
		})

		//Hiển Thị
		$(document).ready(function () {

			$('#hocsinhtable').dataTable({
				"bInfo": false,
				"responsive": false,
				"autoWidth": false,
				"ajax": {
					"type": "GET",
					"url": "GetListHocSinh/",
					"contentType": "application/json",
					"datatype": "json",
					"dataSrc": function (json) {
						console.log(json.data)
						return json.data;
					},

				},
				"columnDefs": [
					{ "data": "maHocSinh", "className": "text-center font-size-15", "orderable": false, "targets": 0 ,
						"render": function (data, type, row, meta) {
							return `<a style="font-family:'Times New Roman';text-decoration:none;" href="/ChinhSuaThongTin/Index/${row.maHocSinh}">${data}</a>`;
						}
					},
					{ "data": "hoTen", "className": "text-center font-size-15", "orderable": false, "targets": 1,
						"render": function (data, type, row, meta) {
							return `<a style="font-family:'Times New Roman';text-decoration:none;" href="/ChinhSuaThongTin/Index/${row.maHocSinh}">${data}</a>`;
						}
					},
					{
						"data": "ngaySinh", "className": "text-center font-size-15", "orderable": false, "targets": 2,
						"render": function (data, type, row, meta) {
							if (data)
								return moment(data).format('DD/MM/YYYY');
							return '';
						}
					},
					{ "data": "email", "className": "text-center font-size-15", "orderable": false, "targets": 3 },
					{ "data": "soDienThoai", "className": "text-center font-size-15", "orderable": false, "targets": 4 },
					{ "data": "maGioiTinh", "className": "text-center font-size-15", "orderable": false, "targets": 5,
					  "render" : function(data){
						  if (data == 1) {
							  return "<span >Nam</span>"
						  }
						  if (data == 2) {
								return "<span >Nữ</span>"
						  }
						  if (data == 3) {
								return "<span >Khác</span>"
							}

					  }
					},
					{ "data": "maLop", "className": "text-center font-size-15", "orderable": false, "targets": 6 },
					{ "data": "diaChiNha", "className": "text-center font-size-15", "orderable": false, "targets": 7 },
					{ "data": "maTrangThai", "className": "text-center font-size-15", "orderable": false, "targets": 8,
						"render": function (data) {
							if (data == 1)
								return "<span class='badge bg-success'  >Đang Học</span>";
							if(data == 2)
								return "<span class='badge bg-danger' >Thôi Học</span>";
						}
					},
					{
						"targets": 9,
						"data": "maHocSinh",
						"orderable": false,
						"render": function (data) {
							return "<input type='checkbox'  value=" + data + " class='myCheckbox text-center' id='myCheckbox' />"
						}
					}
				],
				language: {
					search: '<i class="fa fa-search pos-abs mt-2 ml-3 text-blue-m2"  style="position: absolute; left: 58%; top: 2%; color:#0984e3"> </i>',
					searchPlaceholder: " Tra cứu ...",
					emptyTable: "Dữ liệu hiện tại chưa có...",
					zeroRecords: "Không tìm thấy dữ liệu...",

					loadingRecords: "<img src='/asset/images/loadingdata.gif' style='width: 40px; height: 40px;'/>",
					paginate: {
						"first": "First",
						"last": "Last",
						"next": "Tiếp theo",
						"previous": "Quay lại"
					}
				},
				oLanguage: {
					"sLengthMenu": "Hiển thị  _MENU_ mẫu tin",
					"sZeroRecords": "Nothing found - sorry",
					"sInfo": "Hiển thị  _START_ đến _END_ của _TOTAL_ mẫu tin",
					"sInfoEmpty": "",
					"sInfoFiltered": "(filtered from _MAX_ total records)"
				},
				"sScrollX": "100%",
				"sScrollXInner": "110%",
				"bScrollCollapse": true
			})


		})


		//Xóa Học Sinh

		$(document).ready(function () {

			$('#delete-btn').click(function (e) {
				e.preventDefault()
				var listData = "";
				$('.myCheckbox:checked').each(function () {
					var data = $(this).val();
					console.log("Giá trị của data khi click vào checkbox: " + data);
					listData = data;
				});
				//var dataNumbers = listData.map(function (str) {
				//    return parseInt(str);
				//});
				console.log(listData)

				if (listData === "") {
					toastr.warning('bạn chưa chọn dữ liệu');
				} else {
					Swal.fire({
						title: "Bạn có chắc là muốn xóa không",
						icon: "info",
						showCancelButton: true,
						confirmButtonColor: "#3085d6",
						cancelButtonColor: "#d33",
						confirmButtonText: "Có",
						cancelButtonText :"Không"
					}).then((result) => {
						if (result.isConfirmed) {
							$.ajax({
								type: "POST",
								url: "DeleteHocSinh/",
								data: { maHocSinh: listData },
								success: function (response) {
									console.log(response)
									if (response.success) {
										Swal.fire({
											title: "Thành công !",
											text: response.success,
											icon: "success"
										});
										setTimeout(function () {
											window.location.reload();
										}, 1500);
									} else {
										Swal.fire({
											title: "Lỗi",
											text: response.failed,
											icon: "error"
										});
									}
								}
							});
						}
					});
					

				}


			});
		})
		


	</script>
}