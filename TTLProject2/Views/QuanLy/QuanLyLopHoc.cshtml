@model TTLProject2.Models.LopHocViewModel
@using Microsoft.AspNetCore.Mvc
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Quản Lý Lớp Học";
}
<h1>Quản Lý Lớp Học</h1>


<!--Datatable-->
<div id="dnn_ctr496_ContentPane" style="position:relative">
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal" style="position:absolute;left:90%;top:2%;z-index:1000;border-radius:50px;">
        <i class="fa-solid fa-plus"></i>
        Thêm Mới 
    </button>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Thêm Mới Lớp Học</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="quanLyLopHoc" method="post"  enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-6">
                                <label for="" class="form-label">Mã Lớp Học</label>
                                <input type="text" class="form-control" id="" autocomplete="MaLopHoc" aria-required="true" placeholder="Vd : 10A11" asp-for="MaLop">
                                <span asp-validation-for="MaLop" class="text-danger"></span>
                            </div>
                            <div class="col-6">
                                <label for="" class="form-label">Tên Lớp Học</label>
                                <input type="text" class="form-control" id="" autocomplete="TenLopHoc" aria-required="true" placeholder="Vd : 10A11" asp-for="TenLop">
                                <span asp-validation-for="TenLop" class="text-danger"></span>
                            </div>
                            <div class="col-12 mt-3">
                                <label for="" class="form-label">Sĩ Số Lớp </label>
                                <input type="text" class="form-control" id="" autocomplete="SiSo" aria-required="true" placeholder="Vd : 45" asp-for="SiSo">
                                <span asp-validation-for="SiSo" class="text-danger"></span>
                            </div>
                            <div class="col-12 mt-3">
                                <label for="" class="form-label">Học Ngoại Ngữ </label>
                                <input type="text" class="form-control" id="" autocomplete="NgoaiNgu" aria-required="true" placeholder="Vd : Tiếng Anh" asp-for="HocNgoaiNgu">
                                <span asp-validation-for="HocNgoaiNgu" class="text-danger"></span>
                            </div>
                            <div class="col-12 mt-3">
                                <label for="" class="form-label">Niên Khóa</label>
                                <select class="form-select" aria-label="Default select example" asp-for="MaNienKhoa" asp-items="Model.DanhSachNienKhoa">
                                    <option hidden disabled selected>-- Chọn Niên Khóa --</option>

                                </select>
                                <span asp-validation-for="MaNienKhoa" class="text-danger"></span>
                            </div>
                            <div class="col-12 mt-3">
                                <label for="" class="form-label">Khối</label>
                                <select class="form-select" aria-label="Default select example" asp-for="MaKhoi" asp-items="Model.DanhSachKhoi">
                                    <option hidden disabled selected>-- Chọn Khối --</option>

                                </select>
                            </div>
                            <div class="col-12 mt-3">
                                <label for="" class="form-label">Giáo Viên Chủ Nhiệm</label>
                                <select class="form-select" aria-label="Default select example" asp-for="MaGiaoVien" asp-items="Model.DanhSachGiaoVien">
                                    <option hidden disabled selected>-- Chọn Giáo Viên Chủ Nhiệm --</option>

                                </select>
                            </div>
                            <div class="col-12 mt-3">
                                <label for="" class="form-label">Thời Khóa Biểu </label>
                                <input type="file" class="form-control" id="" asp-for="ThoiKhoaBieu" placeholder="">
                               
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                        <button type="submit" class="btn btn-primary">Thêm Mới</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!--End modal-->
  
    <!-- Start_Module_484 --><div id="dnn_ctr496_ModuleContent" class="DNNModuleContent ModThacsyOnlineC">
        <div id="dnn_ctr496_View_pnlContainer">
            <style>
                .DKForm {
                    margin: 20px auto;
                    padding: 10px 20px;
                    border: 1px dashed #ddd;
                }
            </style>
            <body>
                <div id="">
                    <div class="DKForm">
                        <div class="row">
                            <div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
                                <table id="lophoctables" class="table table-striped " style="min-width: max-content;">
                                    <thead class="text-secondary-m2 bg-tbl-header ">
                                        <tr class="text-white">
                                            <th class="border-0">Mã lớp Học </th>
                                            <th class="border-0">Tên Lớp Học </th>
                                            <th class="border-0">Sĩ Số </th>
                                            <th class="border-0">Học Ngoại Ngữ</th>
                                            <th class="border-0">Niên Khóa</th>
                                            <th class="border-0">Giáo Viên Chủ Nhiệm</th>

                                            <th class="border-0 tbl-column-130"><i class="fa fa-cog"></i></th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </body>
        </div>
    </div>
</div>
<!--End Datatables-->
<link rel="stylesheet" href="~/css/style.css" />
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="https://code.jquery.com/jquery-3.7.1.js"> </script>
    <script src="~/js/datatables.js"></script>
    <script src="~/lib/moment/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
 
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
   
 
    <script>
        $(document).ready(function () {
            $('#lophoctables').dataTable({
                "bInfo": false,
                "responsive": false,
                "autoWidth": false,
                "ajax": {
                    "type": "GET",
                    "url": "getAllLopHoc/",
                    "contentType": "application/json",
                    "datatype": "json",
                    "dataSrc": function (json) {
                        console.log(json.data)
                        return json.data;
                    },

                },
                "columnDefs": [
                    { "data": "maLop", "className": "text-center font-size-15", "orderable": false, "targets": 0 },
                    { "data": "tenLop", "className": "text-center font-size-15", "orderable": false, "targets": 1 },
                    { "data": null, "className": "text-center font-size-15", "orderable": false, "targets": 2,
                        "render": function (row) {
                            return `<span>${row.soLuong}/${row.siSo}</span>`
                        }
                    },
                    { "data": "hocNgoaiNgu", "className": "text-center font-size-15", "orderable": false, "targets": 3 },
                    { "data": "tenNienKhoa", "className": "text-center font-size-15", "orderable": false, "targets": 4 },
                    { "data": "hoTen", "className": "text-center font-size-15", "orderable": false, "targets": 5 },
                    {

                        "data": "maLop",
                        "targets": 6,
                        "className": "text-center font-size-35",
                        "orderable": false,
                        "render": function (data) {
                            return "<span ><a href='/QuanLy/EditLopHoc?MaLop=" + data + "'><i class='fa-solid fa-pen-to-square p-2 fs-3'></i></a></span><span class='text-center fs-3' style='' id='' onclick='deleteLopHoc(\"" + data + "\")'><i class='fa-solid fa-trash text-danger'></i></span>"
                        }
                    }
                ],
                searching :false,
                language: {
                    search: '<i class="fa fa-search pos-abs mt-2 ml-3 text-blue-m2"  style="position: absolute; left: 56%; top: 3%; color:#0984e3"> </i>',
                    searchPlaceholder: " Tra cứu ...",
                    emptyTable: "Dữ liệu hiện tại chưa có...",
                    zeroRecords: "Không tìm thấy dữ liệu...",

                    loadingRecords: "<img src='/asset/images/loadingdata.gif' style='width: 40px; height: 40px;'/>",
                    paginate: {
                        "first": "First",
                        "last": "Last",
                        "next": "Tiếp theo",
                        "previous": "Quay lại"
                    }
                },
                oLanguage: {
                    "sLengthMenu": "Hiển thị  _MENU_ mẫu tin",
                    "sZeroRecords": "Nothing found - sorry",
                    "sInfo": "Hiển thị  _START_ đến _END_ của _TOTAL_ mẫu tin",
                    "sInfoEmpty": "",
                    "sInfoFiltered": "(filtered from _MAX_ total records)"
                },
            })


        })

        //insert


        //delete
      
            function deleteLopHoc(data) {
                console.log("Deleting class with ID:", data);
                Swal.fire({
                    title: "Bạn có chắc là muốn xóa Lớp học  này?",

                    icon: "info",
                    showCancelButton: true,
                    confirmButtonColor: "#3085d6",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "có"
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            type: "POST",
                            url: "/QuanLy/DeleteLop/",
                             data: { id: data },
                            success: function (response) {
                                console.log(response)
                                if (response.success) {
                                    Swal.fire({
                                        title: "Thành công !",
                                        text: response.success,
                                        icon: "success"
                                    });
                                    setTimeout(function () {
                                        window.location.reload();
                                    }, 1500);
                                } else {
                                    Swal.fire({
                                        title: "Lỗi",
                                        text: response.failed,
                                        icon: "error"
                                    });
                                }
                            }
                        })
                    }
                });

            }

       
       
        $(document).ready(function () {
            $("#quanLyLopHoc").submit(function (e) {
                var formData = new FormData($(this)[0]);
                console.log(formData);
                $.ajax({
                    url: "/QuanLy/ThemMoiLopHoc",
                    type: "POST",
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        console.log(response)
                        if (response.success) {
                            Swal.fire({
                                title: "Thành công !",
                                text: response.success,
                                icon: "success"
                            });
                            setTimeout(function () {
                                window.location.reload();
                            }, 1500);
                            console.log(response.success);
                        }
                        else if (response.error == "Lớp Học đã tồn tại , vui lòng kiểm tra lại thông tin vừa nhập" || response.error == "Giáo viên này đã có lớp xin vui lòng chọn giáo viên khác") {
                            Swal.fire({
                                title: "Lỗi  !",
                                text: response.error,
                                icon: "error"
                            });

                            console.log(response.error);
                        }
                        else {
                            Swal.fire({
                                title: "Lỗi  !",
                                text: response.error,
                                icon: "warning"
                            });
                            setTimeout(function () {
                                window.location.reload();
                            }, 15000);
                           
                            console.log(response.error);
                        }
                    },
                    error: function (xhr, status, error) {

                        console.log(xhr.responseText);
                    }
                })
            })
        })
    </script>
}
