@model TTLProject2.Models.GiaoVienViewModel
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
	ViewData["Title"] = "Quản Lý Giáo Viên";
}
<div class="container-fluid">
	<h3 class="mt-3 p-3">Quản Lý Giáo Viên</h3>
	<div id="dnn_ctr496_ContentPane">
		<!-- Start_Module_484 --><div id="dnn_ctr496_ModuleContent" class="DNNModuleContent ModThacsyOnlineC">
			
			<div id="dnn_ctr496_View_pnlContainer" style="position:relative">
				<!--Button Modal-->
				<button type="button" class="btn btn-success " data-bs-toggle="modal" data-bs-target="#exampleModal" style="position:absolute;left:74%;top:4%;z-index:100;border-radius:20px;">
					<i class="fa-solid fa-plus"></i>
					Thêm
				</button>
				<button type="submit" class="btn btn-danger" id="delete-btn" style="position:absolute;left:81%;top:4%;border-radius:50px;z-index:1000;">
					<i class="fa-solid fa-trash"></i>
					Xóa
				</button>
				<button type="submit" class="btn text-white " style="position:absolute;left:87%;top:4%;border-radius:50px;z-index:1000;background-color:#3c8dbc;">
					<i class="fa-regular fa-envelope"></i>
					mail
				</button>
				<!--Button Modal end-->
				<!--Model thêm mới -->
				<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
					<div class="modal-dialog modal-lg">
						<div class="modal-content">
							<div class="modal-header" style="background-color:#005a9c">
								<h5 class="modal-title text-white" id="exampleModalLabel"> <img src="~/files/2024/images/logo1.jpg" style="width:50px; border-radius:50%;" /> Thêm Mới Giáo Viên </h5>
								<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>
							<form  method="post" id="GiaoVienForm" enctype="multipart/form-data">
								<div class="modal-body">
									<div class="mb-3">
										<label for="" class="form-label">Mã Giáo Viên </label>
										<input type="text" class="form-control" id="" asp-for="MaGiaoVien" placeholder="Vd : GV...">

									</div>
									<div class="row">
										<div class="mb-3 col-md-4">
											<label for="" class="form-label">Tên Giáo Viên </label>
											<input type="text" class="form-control" id="" asp-for="HoTen" placeholder="VD : Võ Đăng Phát">
										</div>
										<div class="mb-3 col-md-4">
											<label for="" class="form-label">Giới Tính  </label>
											<select class="form-select" aria-label="Default select example" asp-for="MaGioiTinh" asp-items="Model.DanhSachGioiTinh" >
												<option hidden disabled selected>Giới tính </option>

											</select>
										</div>
										<div class="mb-3  col-md-4">
											<label for="" class="form-label">Ngày Sinh  </label>
											<input type="date" class="form-control" id="" asp-for="NgaySinh" placeholder="Ngày Sinh">
										</div>
									</div>

									<div class="mb-3">
										<label for="" class="form-label">Số CCCD</label>
										<input type="text" class="form-control" id="" asp-for="CCCD" placeholder="VD : 079....">
									</div>
									<div class="row">
										<div class="mb-3 col-md-4">
											<label for="" class="form-label">Email</label>
											<input type="email" class="form-control" id="" asp-for="Email" placeholder="VD : ...gmail.com">
										</div>
										<div class="mb-3 col-md-4">
											<label for="" class="form-label">Số Điện Thoại </label>
											<input type="text" class="form-control" id="" asp-for="DienThoai" placeholder="VD : 09...">
										</div>
										<div class="mb-3 col-md-4">
											<label for="" class="form-label">Tôn Giáo </label>
											<select class="form-select" aria-label="Default select example" asp-for="MaTonGiao" asp-items="Model.DanhSachTonGiao" >
												<option hidden disabled selected>Tôn Giáo </option>

											</select>
										</div>
									</div>


									<div class="mb-3">
										<label for="" class="form-label">Quê Quán</label>
										<input type="text" class="form-control" asp-for="QueQuan" id="" placeholder="VD :TPHCM">
									</div>
									<div class="mb-3">
										<label for="" class="form-label">Số Bảo Hiểm Xã hội</label>
										<input type="text" class="form-control" id="" asp-for="SoBaoHiemXaHoi" placeholder="">
									</div>
									<div class="mb-3">
										<label for="" class="form-label">Hình Ảnh </label>
										<input type="file" class="form-control" id="" asp-for="HinhAnh" placeholder="">
									</div>
									<div class="row">
										<div class="col-md-6">
											<label for="" class="form-label">Dân Tộc </label>
											<select class="form-select" aria-label="Default select example" asp-for="MaDanToc" asp-items="Model.DanhSachDanToc">
												<option hidden disabled selected>Dân Tộc</option>

											</select>
										</div>
										<div class="col-md-6">
											<label for="" class="form-label">Trạng Thái</label>
											<select class="form-select" aria-label="Default select example" asp-for="MaTrangThai" asp-items="Model.DanhSachTrangThai">
												<option hidden disabled selected>Trạng Thái </option>

											</select>
										</div>
										<div class="col-md-12 mt-3">
											<label for="" class="form-label">Môn Dạy Chính </label>
											<select class="form-select" aria-label="Default select example" asp-for="MaMonHoc" asp-items="Model.DanhSachMonHoc" >
												<option selected>Môn Dạy Chính</option>

											</select>
										</div>
									</div>

								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>

									<button type="submit" class="btn btn-primary">Thêm mới </button>
								</div>
							</form>
						</div>
					</div>
				</div>
				<!--Model thêm mới kết thúc-->
				<style>
					.DKForm {
						margin: 20px auto;
						padding: 10px 20px;
						border: 1px dashed #ddd;
					}
				</style>
				<body>
					<div id="">
						<div class="DKForm">
							<div class="row">
								<div class="col-sm-12 col-md-12 col-lg-12 col-xl-12">
									<table id="giaovientable" class="table table-striped table-bordered" style="min-width: max-content;">
										<thead class="text-secondary-m2 bg-tbl-header " style="background-color:#005a9c;">
											<tr class="text-white">
												<th class="border-0">Mã Giáo Viên</th>
												<th class="border-0">Họ Tên Giáo Viên  </th>
												<th class="border-0">Ngày Tháng Năm Sinh</th>
												<th class="border-0">Số Điện Thoại </th>
												<th class="border-0">Email</th>
												<th class="border-0">Môn Dạy Chính</th>
												<th class="border-0">Trạng thái</th>

												<th class="border-0 tbl-column-130"><i class="fa fa-cog"></i></th>
											</tr>
										</thead>
										<tbody></tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</body>
			</div>
		</div>
	</div>
</div>

<link rel="stylesheet" href="~/css/style.css" />
<link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/css/select2.min.css" rel="stylesheet" />
@section Scripts {
	<partial name="_ValidationScriptsPartial" />
	<script src="https://code.jquery.com/jquery-3.7.1.js"> </script>
	<script src="~/js/datatables.js"></script>
	<script src="~/lib/moment/moment.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0/js/select2.min.js"></script>

	<script>
		$(document).ready(function () {
			$('#giaovientable').dataTable({
				"bInfo": false,
				"responsive": false,
				"autoWidth": false,
				"ajax": {
					"type": "GET",
					"url": "GetGiaoVienList/",
					"contentType": "application/json",
					"datatype": "json",
					"dataSrc": function (json) {
						console.log(json.data)
						return json.data;
					},

				}, 
				"columnDefs": [
					{ "data": "maGiaoVien", "className": "text-center font-size-15", "orderable": false, "targets": 0 ,
						"render": function (data, type, row, meta) {
							return `<a style="font-family:'Times New Roman';text-decoration:none;"  href="">${data}</a>`;
						}
					},
					{ "data": "hoTen", "className": "text-center font-size-15", "orderable": false, "targets": 1 ,
						"render": function (data, type, row, meta) {
							return `<a style="font-family:'Times New Roman';text-decoration:none;" href="" >${data}</a>`;
						}
					},
					{
						"data": "ngaySinh", "className": "text-center font-size-15", "orderable": false, "targets": 2, "render": function (data, type, row) {

							if (type === "display") {

								var ngay = new Date(data);
								return ngay.getDate() + '/' + (ngay.getMonth() + 1) + '/' + ngay.getFullYear();
							}

							return data;
						}
					},
					{ "data": "dienThoai", "className": "text-center font-size-15", "orderable": false, "targets": 3 },
					{ "data": "email", "className": "text-center font-size-15", "orderable": false, "targets": 4 },
					{ "data": "maMonHoc", "className": "text-center font-size-15", "orderable": false, "targets": 5 ,
						"render": function (data) {
							if(data == 1)
							   return "<span>Toán</span>"
							if(data == 2)
							   return "<span>Ngữ văn</span>"
							if(data == 3)
							   return "<span>Ngoại Ngữ</span>"
							if (data == 4)
								return "<span>Sinh Học</span>"
							if (data == 5)
								return "<span>Lịch Sử</span>"
							if (data == 6)
								return "<span>Địa Lý</span>"
							if (data == 7)
								return "<span>Hóa Học</span>"
							if (data == 8)
								return "<span>GDCD</span>"
							if (data == 9)
								return "<span>Công Nghệ</span>"
							if (data == 10)
								return "<span>Tin Học</span>"
							if (data == 11)
								return "<span>Thể Dục</span>"

						}
					},
					{ "data": "maTrangThai", "className": "text-center font-size-15", "orderable": false, "targets": 6,
						"render": function (data) {
							if(data == 6 )
								return "<span class='badge rounded-pill bg-success'  >Đang Dạy</span>";
							if (data == 7)
								return "<span class='adge rounded-pill bg-warning text-dark' >Nghỉ thai sản</span>";
							if (data == 8)
								return "<span class='badge rounded-pill bg-danger'  >Đang Dạy</span>";
							if (data == 1)
								return "<span class='badge rounded-pill bg-success'  >Đang Học</span>";
						}
					},
					{
						"targets": 7,
						"data": "maGiaoVien",
						"render": function (data) {
							return "<input type='checkbox'  value=" + data + " class='myCheckbox' id='myCheckbox' />"
						}
					}
				],
				language: {
					search: '<i class="fa fa-search pos-abs mt-2 ml-3 text-blue-m2"  style="position: absolute; left: 56%; top: 2%; color:#0984e3"> </i>',
					searchPlaceholder: " Tra cứu ...",
					emptyTable: "Dữ liệu hiện tại chưa có...",
					zeroRecords: "Không tìm thấy dữ liệu...",

					loadingRecords: "<img src='/asset/images/loadingdata.gif' style='width: 40px; height: 40px;'/>",
					paginate: {
						"first": "First",
						"last": "Last",
						"next": "Tiếp theo",
						"previous": "Quay lại"
					}
				},
				oLanguage: {
					"sLengthMenu": "Hiển thị  _MENU_ mẫu tin",
					"sZeroRecords": "Nothing found - sorry",
					"sInfo": "Hiển thị  _START_ đến _END_ của _TOTAL_ mẫu tin",
					"sInfoEmpty": "",
					"sInfoFiltered": "(filtered from _MAX_ total records)"
				},
				select: {
					rows: {
						_: '(đã chọn %d dòng)',
						0: '',
						1: '(đã chọn 1 dòng)'
					}
				},
				select: {
					style: 'multis'
				},
				order: [],//no specific initial ordering,
				initComplete: function (settings, json) {
					dataTable.buttons().container().appendTo($('.dataTables_filter', dataTable.table().container()));
					$('.icon').each(function () {
						var div = $(this).find('span.d-none').first();
						if (div.length == 1)
							$(this).tooltip({ container: 'body', title: div.text() });
						else
							$(this).tooltip({ container: 'body', title: $(this).text() });
					});
					$('.table-page')//specified above in $.fn.dataTable.defaults
						.append($('#datatable_info'))
						.end();
				}
			})
		})

		$(document).ready(function () {
			$("#GiaoVienForm").submit(function (e) {
				e.preventDefault();
				var formData = new FormData($(this)[0]);
				console.log(formData);
				$.ajax({
					url: "InsertGiaoVien/",
					type: "POST",
					data: formData,
					contentType: false,
					processData: false,
					success: function (response) {
						console.log(response)
						if (response.success) {
							Swal.fire({
								title: "Thành công !",
								text: response.success,
								icon: "success"
							});
							setTimeout(function () {
								window.location.reload();
							}, 1500);
							console.log(response.success);
						}

						else if (response.error) {
							Swal.fire({
								title: "Lỗi  !",
								text: response.error,
								icon: "error"
							});

							console.log(response.error);
						}
						else {
							Swal.fire({
								title: "Lỗi  !",
								text: "Bạn chưa nhập đầy đủ thông tin  ",
								icon: "error"
							});

							console.log(response.error);
						}
					},
					error: function (xhr, status, error) {

						console.log(xhr.responseText);
					}
				})
			})
		})
	</script>
}